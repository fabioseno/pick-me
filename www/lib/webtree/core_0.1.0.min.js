/*! Core 2015-05-01 */
angular.module("wt-core",[]).config(["$httpProvider",function(a){"use strict";a.interceptors.push("connectivityInterceptor"),a.interceptors.push("authenticationInterceptor"),a.interceptors.push("accessDeniedInterceptor")}]).run(["cacheHandler",function(a){"use strict";a.setProvider("localStorageProxy")}]),angular.module("wt-core").service("jsonFormatter",function(){"use strict";this.isJSON=function(a){var b=!0;if("object"!=typeof a)try{JSON.parse(a)}catch(c){b=!1}return b},this.wrap=function(a){return angular.isString(a)?a:JSON.stringify(a)},this.unwrap=function(a){return this.isJSON(a)?JSON.parse(a):a}}),angular.module("wt-core").service("cacheHandler",["$injector",function(a){"use strict";var b,c,d,e,f,g=[],h=this;h.setProvider=function(d){b=d,c=a.get(b)},h.setCacheRules=function(a){g=a},h.filterData=function(a,b){var c;if(b&&b.data)if(c=b.data,g.length>0){for(e=(new Date).getTime(),f=0;f<g.length;f+=1)if(d=g[f],a.indexOf(d.key)>=0){e-b.timestamp>6e4*d.expiration&&(c=void 0);break}}else c=b.data;return c},h.cacheData=function(a,b){c.add(a,{timestamp:(new Date).getTime(),data:b})},h.getCachedData=function(a){var b=c.get(a);return h.filterData(a,b)},h.clearCache=function(){c.clear()}}]),angular.module("wt-core").factory("connectivityInterceptor",["$rootScope","$q",function(a,b){"use strict";return{responseError:function(c){return 0===c.status&&a.$broadcast("DICONNECTED",c),b.reject(c)}}}]),angular.module("wt-core").service("eventHub",["$rootScope","$log","jsonFormatter",function(a,b,c){"use strict";this.fire=function(d,e){var f="";f=1===arguments.length?" with no arguments":" with arguments "+c.wrap(Array.prototype.slice.call(arguments,1)),b.debug("[EVENT] - Calling event ["+d+"]"+f),a.$broadcast.apply(a,arguments)}}]),angular.module("wt-core").service("httpProxy",["$http","$cacheFactory","$q","$timeout","cacheHandler","jsonFormatter",function(a,b,c,d,e,f){"use strict";function g(a,b,c,d){return{data:a,status:b,headers:c,config:d}}function h(a,b){var d=c.defer();return m.push({cacheKey:a,value:{defer:d,cacheable:b}}),d.promise}function i(a,b,c){{var d;e.getCachedData(b)}for(d=m.length-1;d>=0;d-=1)m[d].cacheKey===b&&(a?m[d].value.defer.resolve(c):m[d].value.defer.reject(c),m.splice(d,1))}function j(a,b,c,d){var f;for(f=0;f<m.length;f+=1)m[f].cacheKey===d.cacheKey&&(m[f].value.cacheable===!0&&e.cacheData(d.cacheKey,a),i(!0,d.cacheKey,g(a,b,c,d)))}function k(a,b,c,d){i(!1,d.cacheKey,g(a,b,c,d))}var l=b("REQUEST_GROUPS"),m=[];this.buildKey=function(a){a.data||(a.data="");var b=a.url+f.wrap(a.data);return b},this.hit=function(b,f,m){b.cacheKey=this.buildKey(b);var n,o,p=e.getCachedData(b.cacheKey);return f=f||!p,m&&(b.cacheable=m),b.timeout||(b.groupName||(b.groupName="default"),o=l.get(b.groupName),o?n=o.defer:(n=c.defer(),l.put(b.groupName,{defer:n})),b.timeout=n.promise),f?a(b).success(j).error(k):d(function(){i(!0,b.cacheKey,g(p,304,angular.noop,b))}),h(b.cacheKey,m)},this.cancelHit=function(a){var b;a||(a="default"),b=l.get(a),b&&(b.defer.resolve("Http request cancelled!"),l.remove(a))}}]),angular.module("wt-core").service("invoker",["httpProxy","eventHub",function(a,b){"use strict";function c(a,b){var c=[],d=a.replace(/:(\w+)/g,function(a,c){b=b||{};var d=b[c];return d||(d=":"+c),d});if(d.indexOf("/:")>0)throw"not all route values were matched";return 0===c.length?d:d+"?"+c.join("&")}var d;this.setConfiguration=function(a){d=a},this.invoke=function(b,e,f,g){if(d){var h=d[b][e],i=!1,j=!1,k={url:h.url,method:h.method,data:f};return k.url=c(k.url,f),h.access_type||(h.access_type="ONLINE"),"ONLINE"===h.access_type?i=!0:"ONLINE_WITH_CACHE"===h.access_type&&(j=!0),g&&g(),a.hit(k,i,j).then(function(a){return a.data})}}}]),angular.module("wt-core").factory("$exceptionHandler",["$injector",function(a){"use strict";return function(b,c){var d=a.get("$log"),e=a.get("eventHub");d.error(b.message),e.fire("APPLICATION_ERROR",b.message,b.stack)}}]),angular.module("wt-core").factory("accessDeniedInterceptor",["$rootScope","$q",function(a,b){"use strict";return{responseError:function(c){return 401===c.status&&a.$broadcast("UNAUTHORIZED",c),b.reject(c)}}}]),angular.module("wt-core").service("authentication",function(){"use strict";var a="";this.getSessionId=function(){return a},this.setSessionId=function(b){a=b},this.context={},this.clearSession=function(){a="",this.context={}}}),angular.module("wt-core").factory("authenticationInterceptor",["authentication",function(a){"use strict";return{request:function(b){var c=a.getSessionId();return c&&(b.headers.SessionId=c),b}}}]),angular.module("wt-core").service("localStorageProxy",["$window","jsonFormatter",function(a,b){"use strict";this.clear=function(){a.localStorage.clear()},this.get=function(c){return b.unwrap(a.localStorage.getItem(b.wrap(c)))},this.getAll=function(){var b,c,d={};for(b=0;b<a.localStorage.length;b+=1)c=a.localStorage.key(b),d[c]=a.localStorage.getItem(c);return d},this.add=function(c,d){a.localStorage.setItem(b.wrap(c),b.wrap(d))},this.remove=function(c){a.localStorage.removeItem(b.wrap(c))}}]),angular.module("wt-core").service("sessionStorageProxy",["$window","jsonFormatter",function(a,b){"use strict";this.clear=function(){a.sessionStorage.clear()},this.get=function(c){return b.unwrap(a.sessionStorage.getItem(b.wrap(c)))},this.getAll=function(){var b,c,d={};for(b=0;b<a.sessionStorage.length;b+=1)c=a.sessionStorage.key(b),d[c]=a.sessionStorage.getItem(c);return d},this.add=function(c,d){a.sessionStorage.setItem(b.wrap(c),b.wrap(d))},this.remove=function(c){a.sessionStorage.removeItem(b.wrap(c))}}]);